# Smart Code Analyzer

Интеллектуальный анализатор кода, который использует искусственный интеллект для анализа и улучшения качества кода.

**Версия:** 0.0.16

## Возможности

- Анализ стиля кода
- Проверка соответствия принципам SOLID
- Выявление потенциальных проблем
- Предложения улучшений и оптимизаций
- Анализ безопасности кода
- Оценка качества кода

## Установка

### Установка пакета
```bash
# Клонируйте репозиторий
git clone https://github.com/sad-engineer/smart_code_analyzer.git
cd smart_code_analyzer
```

### Установка зависимостей
```bash
poetry install
```

## Необходимые переменные окружения

Проект построен на использовании сервисов OpenAI.
Поскольку доступ к ним заблокирован, в качестве посредника используем proxyapi.ru. 

Необходимо:
1. Зарегистрироваться на API Platform (https://auth.openai.com/log-in)
1. В разделе "settings -> API keys" создать your_api_key кнопкой "Create new secret key"
3. Зарегистрироваться на https://proxyapi.ru
4. В разделе "Ключи API" создать your_proxy_key кнопкой "Создать новый ключ API"
5. Выбрать модель генерации отчета.

Для работы приложения необходимо внести эти данные в переменные окружения в файле `.env`:

### Создаем файл `.env` вручную
Добавляем в него:
```env
# API ключ OpenAI (обязательно)
OPENAI_API_KEY=your_api_key

# API ключ для прокси (обязательно)
PROXYAPI_KEY=your_proxy_key

# Модель ИИ (опционально, по умолчанию gpt-3.5-turbo)
AI_MODEL=gpt-3.5-turbo

# Температуру генерации ответа (опционально, по умолчанию 0.3)
AI_TEMPERATURE=0.3
```

### Создаем файл `.env` через консоль
```bash
# Создайте файл .env с необходимыми переменными окружения
echo "OPENAI_API_KEY=your_api_key" > .env
echo "PROXYAPI_KEY=your_proxy_key" >> .env
echo "AI_MODEL=gpt-3.5-turbo" >> .env
echo "AI_TEMPERATURE=0.3" >> .env
```

## Запуск

### Через Poetry
```bash
poetry run uvicorn smart_code_analyzer.backend.main:app --reload --host 0.0.0.0 --port 8000
```

### Через Docker Compose
```bash
docker-compose up --build
```

## Доступные сервисы

После запуска будут доступны:
- Веб-интерфейс: http://localhost:8000
- Документация API: http://localhost:8000/docs, http://localhost:8000/redoc
- Метрики Prometheus: http://localhost:8000/metrics
- Grafana: http://localhost:3001
  - Логин: admin
  - Пароль: admin
  - При первом входе потребуется сменить пароль


## Настройки генерации отчета

*AI_MODEL* - идентификатор модели. 
Отвечает за конкретную модель, которую проект будет использовать для генерации ИИ-отчета. 
Список моделей можно посмотреть на странице https://proxyapi.ru/pricing. 

Очевидно, что выбирать модели необходимо из раздела "Языковые модели" или "Рассуждающие модели". 
Работоспособность проекта тестировалась на модели "gpt-4.1-mini".

*AI_TEMPERATURE* - в контексте API OpenAI отвечает за креативность и разнообразие ответов модели. Диапазон значений от 0.0 до 2.0.

***Temperature = 0.0:***

Модель дает самые предсказуемые, детерминированные ответы. Всегда выбирает наиболее вероятные токены. Подходит для задач, требующих консистентности.
```
"Код нарушает PEP8. Переменная 'userData' должна быть 'user_data'. 
Используйте snake_case для всех переменных."
```

***Temperature = 0.3:***

Умеренно консервативные ответы. Хорошо для production-среды, где важна стабильность результатов.
```
"Код нарушает PEP8. Используйте snake_case для переменных. 
Рекомендую переименовать 'userData' в 'user_data'."
```

***Temperature = 0.5:*** 

Идеальный баланс между креативностью и предсказуемостью. Рекомендуется для большинства задач анализа кода.
```
"Код нарушает PEP8, но структура логична. 
Рекомендую переименовать переменные в snake_case. 
Также добавьте документацию к функциям."
```

***Temperature = 0.7:***

Умеренно креативные ответы. Может находить неочевидные проблемы и предлагать оригинальные решения. Значение по умолчанию для проекта.
```
"Код нарушает PEP8, но я вижу, что вы работаете 
с внешним API. Возможно, стоит создать адаптер 
для преобразования имен переменных."
```

***Temperature = 1.0:***

Стандартный баланс между креативностью и предсказуемостью (значение по умолчанию для OpenAI модели).
```
"Интересный подход! Код нарушает PEP8, но я понимаю 
контекст интеграции с JavaScript API. Рассмотрите 
создание конфигурационного слоя для маппинга имен."
```

***Temperature = 1.5:***

Высокая креативность. Может давать неожиданные, но интересные инсайты.
```
"Хм, вижу смешанный стиль именования. Возможно, 
это legacy код или интеграция с внешними системами? 
Предлагаю рефакторинг с сохранением совместимости 
через декораторы или адаптеры."
```

***Temperature = 2.0:***

Максимальная креативность, но может давать менее связные ответы. Используйте осторожно.
```
"Вау! Такой подход к именованию переменных... 
Может быть, это экспериментальный код? 
Или вы тестируете новую архитектуру? 
В любом случае, стоит добавить комментарии 
обоснования такого выбора."
```

**Рекомендации для анализатора кода:**
- 0.3: Для стабильного анализа в production 
- 0.5: Для баланса между качеством и разнообразием
- 0.7: Для более креативного анализа с неочевидными инсайтами (значение по умолчанию для проекта)
- 1.0+: Для исследовательского анализа и поиска неочевидных проблем


## Использование

Взаимодействие с программой производится посредством веб-страницы по адресу: http://localhost:8000

Созданный пользователем код нужно загрузить в окно загрузки кода

![Окно загрузки кода](docs/images/1.png)

Загружать можно файлом или пакетом (в том числе, и с вложенными пакетами). 
После загрузки появится раскрывающийся список с количеством загруженных файлов.

![Окно загрузки кода после загрузки пакета файлов](docs/images/2.png)

Загруженные файлы можно посмотреть раскрыв список.

![Список загруженных файлов](docs/images/3.png)

### Анализ кода

Кнопка "Анализировать код" запускает Parsing-анализ по загруженным файлам.
При загрузке кода пакетом, первый блок результатов анализа будет содержать общую сводку по пакету.

![Общая сводка](docs/images/4.png)

#### Блок отчета содержит:

***Общая сводка:***
- Всего файлов
- Количество строк кода
- Количество строк комментариев
- Количество пустых строк
- Количество классов
- Количество функций
- Количество констант

Индивидуальные результаты по каждому файлу содержатся в раскрывающихся блоках.

### ИИ-анализ структуры

Здесь же можно запросить результаты ИИ-анализа структуры, кликнув по кнопке "ИИ-анализ структуры". 
Анализ может занять длительное время, о загрузке анализа сообщит информация на кнопке.

![Кнопка "ИИ-анализ структуры" в процессе загрузки анализа](docs/images/5.png)

После загрузки ИИ-анализа, результаты будут доступны в блоке под кнопкой.

![ИИ-анализ структуры](docs/images/6.png)

#### В анализе доступны:
- Рекомендации по архитектуре и организации модулей
- Как связаны модули между собой
- Сильные стороны структуры
- Слабые стороны структуры
- Общие рекомендации по улучшению пакета

### Анализ отдельных файлов

Для каждого загруженного файла отображается:
- статус Parsing-анализа (например, "completed"), 
- результат этого анализа (в раскрывающемся списке)
- кнопка запроса ИИ-анализа кода файла.

Эту информацию можно получить раскрыв блок с именем соответствующего файла. 
Также, для каждого файла доступна кнопка "ИИ-анализ".

![Окно загрузки кода](docs/images/7.png)

#### Анализ файла включает:
- Оценка и рекомендации стиля кода
- Оценка и рекомендации по соответствию принципам SOLID
- Оценка и рекомендации на предмет потенциальных проблем
- Оценка и рекомендации по улучшению кода

![Окно загрузки кода](docs/images/9.png)

При загрузке одного файла, доступны все механики для файла (включая ИИ-анализ файла) 

![Окно загрузки кода](docs/images/10.png)

## Структура проекта

```
smart_code_analyzer/
├── backend/                  # Backend на FastAPI
│   ├── ai_analyzer.py        # Класс ИИ-анализатора
│   ├── analyzer_api.py       # API endpoints
│   ├── Dockerfile.backend    # Dockerfile для backend
│   ├── main.py               # Точка входа
│   ├── models.py             # Модели данных
│   └── __init__.py
├── frontend/                 # Frontend на React
│   ├── src/
│   │   ├── App.tsx
│   │   └── input.css
│   │   ├── static/
│   │   │   └── js/
│   │   │       └── main.js
│   │   ├── templates/
│   │   │   └── index.html
│   │   ├── Dockerfile.frontend
│   │   ├── package.json
│   │   └── tailwind.config.js
│   ├── .env                      # Конфигурация окружения
│   ├── docker-compose.yml        # Docker Compose конфигурация
│   ├── prometheus.yml            # Конфигурация Prometheus
│   └── run.py                    # Скрипт запуска
```
